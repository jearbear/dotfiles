colorscheme catppuccin_mocha


#
# OPTIONS
#

set-option global startup_info_version 20240518
set-option global scrolloff 5,5
set-option global autoreload true
set-option global ui_options terminal_enable_mouse=false terminal_assistant=none
set-option global modelinefmt '%val{bufname} {{context_info}} {{mode_info}}'

set-option global grepcmd 'rg --column --smart-case --sort path'

add-highlighter global/ wrap -indent -marker ...
add-highlighter global/ show-matching -previous


#
# COMMANDS
#

define-command pick-file -docstring 'fuzzy find a file' %{
    prompt -shell-script-candidates 'fd --type file' file: %{ edit -existing %val{text} }
}

define-command pick-buffer -docstring 'fuzzy find a buffer' %{
    prompt -buffer-completion buffer: %{ buffer %val{text} }
}


#
# MAPPINGS
#

map global user w :w<ret>             -docstring "save file" 
map global user q :q<ret>             -docstring "quit" 
map global user x :wq<ret>            -docstring "save + quit" 
map global user / :comment-line<ret>  -docstring "comment line(s)" 
map global user f ":pick-file<ret>"   -docstring "pick file" 
map global user l ":pick-buffer<ret>" -docstring "pick buffer" 
map global user n ":new<ret>"         -docstring "open new window" 
map global user * '*%s<ret>'          -docstring "select all"

# Insert lines above/below
map global normal <ret> <a-o>
map global normal <s-ret> <a-O>

# Readline mappings
map global insert <c-a> <home>
map global insert <c-e> <end>
map global insert <c-f> <right>
map global insert <c-b> <left>
map global insert <c-d> <del>
map global insert <c-h> <backspace>
map global insert <c-k> '<a-;>;<a-;>Gl<a-;>"_d'
map global insert <c-u> '<a-;>;<a-;>h<a-;>Gh<a-;>"_d'
map global insert <c-w> '<a-;><a-/>\S+\s*<ret><a-;>d'

# Faster scrolling
map global normal <c-d> 5j
map global normal <c-u> 5k


#
# HOOKS
#

# Save file on focus lost
hook global FocusOut .* %{ try "write" }

# Change cursor color depending on the mode
hook global ModeChange push:.*:insert %{
    set-face window PrimaryCursor LineNumbers
    set-face window PrimaryCursorEol LineNumbers
}
hook global ModeChange pop:insert:.* %{
    unset-face window PrimaryCursor
    unset-face window PrimaryCursorEol     
}

# Highlight current line
hook global RawKey .+ %{
    try %{ remove-highlighter window/cursor-line }
    try %{ add-highlighter window/cursor-line line %val{cursor_line} default,rgb:313244 }
}


#
# PLUGINS
#

hook global ModuleLoaded kitty %{
    set-option global kitty_window_type 'os-window'
}

# Always use spaces for indentation
hook global ModuleLoaded smartab %{
    smarttab
    set-option global softtabstop 4
}
